cmake_minimum_required(VERSION 3.10)

project(libutils)

aux_source_directory("src/" SRC)
aux_source_directory("src/implementations" SRC_implementations)
aux_source_directory("src/TimerTask" SRC_TimerTask)
aux_source_directory("src/Daemon" SRC_Daemon)
aux_source_directory("src/ThreadSlice" SRC_ThreadSlice)

add_library(${PROJECT_NAME} ${SRC} ${SRC_implementations} ${SRC_TimerTask} ${SRC_Daemon} ${SRC_ThreadSlice})
target_include_directories(${PROJECT_NAME} PUBLIC "include")
target_include_directories(${PROJECT_NAME} PRIVATE "src")

option(BDUIL_MAIN "编译.exe测试程序" ON)
option(BDUIL_GTEST "进行GTEST测试" OFF)
if(BDUIL_MAIN)
	find_package(GTest CONFIG REQUIRED)
	
	set(TEST_PROJECT ${PROJECT_NAME}-test)
	if(BDUIL_GTEST)
		add_executable(${TEST_PROJECT} "tests/TestThreadSlice.cpp" "tests/TestTimerTask.cpp")
		target_link_libraries(${TEST_PROJECT} PRIVATE GTest::gtest_main)
	else()
		add_executable(${TEST_PROJECT} "tests/main.cpp")
	endif()

	target_link_libraries(${TEST_PROJECT} PRIVATE ${PROJECT_NAME})
	target_compile_options(${TEST_PROJECT} PRIVATE "$<$<C_COMPILER_ID:MSVC>:/utf-8>" "$<$<CXX_COMPILER_ID:MSVC>:/utf-8>")
endif()

target_compile_options(${PROJECT_NAME} PRIVATE "$<$<C_COMPILER_ID:MSVC>:/utf-8>" "$<$<CXX_COMPILER_ID:MSVC>:/utf-8>")
